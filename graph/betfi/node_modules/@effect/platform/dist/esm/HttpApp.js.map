{"version":3,"file":"HttpApp.js","names":["Context","Effect","Exit","Fiber","FiberRef","GlobalValue","Layer","Option","Runtime","Scope","Stream","unify","HttpBody","ServerError","ServerRequest","ServerResponse","internal","internalMiddleware","handledSymbol","Symbol","for","toHandled","self","handleResponse","middleware","responded","withFiberRuntime","fiber","flatMap","response","request","unsafeGet","currentContext","HttpServerRequest","handler","getFiberRef","currentPreResponseHandlers","_tag","as","tap","value","withErrorHandling","catchAllCause","cause","causeResponse","zipRight","failCause","withMiddleware","undefined","tracer","matchCauseEffect","onFailure","void","_cause","empty","status","onSuccess","uninterruptible","scoped","ejectDefaultScopeClose","scope","ejectedScopes","add","unsafeEjectStreamScope","body","getOrThrow","getCurrentFiber","setBody","stream","ensuring","close","contentType","contentLength","globalValue","WeakSet","effect","make","onExit","extend","exit","has","appendPreResponseHandler","withPreResponseHandler","toWebHandlerRuntime","runtime","run","runFork","resolveSymbol","httpApp","toWeb","withoutBody","method","context","Promise","resolve","contextMap","Map","unsafeMap","isContext","key","set","httpServerRequest","fromWeb","locally","unsafeMake","signal","addEventListener","unsafeInterruptAsFork","clientAbortFiberId","once","toWebHandler","defaultRuntime","toWebHandlerLayer","layer","runSync","runPromise","build","map","toRuntime","_","runner","then"],"sources":["../../src/HttpApp.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}