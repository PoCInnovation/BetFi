{"version":3,"file":"store.js","names":["createStore","mergeMessages","idToAutomergeId","initialStoreContext","spaces","spacesLoadingIsPending","updatesInFlight","invitations","repo","identities","authenticated","identity","lastUpdateClock","accountInboxes","mapping","store","context","on","setInvitations","event","setMapping","reset","addUpdateInFlight","updateId","removeUpdateInFlight","filter","id","setSpacesList","storeContext","space","existingSpace","find","s","result","findWithProgress","handle","doneLoading","map","newSpace","name","events","state","keys","automergeDocHandle","inboxes","undefined","applyEvent","spaceId","updateConfirmed","clock","applyUpdate","firstUpdateClock","addVerifiedIdentity","accountAddress","encryptionPublicKey","signaturePublicKey","accountProof","keyProof","setSpaceInbox","existingInbox","inbox","inboxId","messages","seenMessageIds","setSpaceInboxMessages","lastMessageClock","Date","Math","max","getTime","toISOString","setAccountInbox","setAccountInboxMessages","setSpace","spaceState","updates","mergedInboxes","newInbox","existingInboxIndex","findIndex","push","setAuth","resetAuth","setRepo"],"sources":["../src/store.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}