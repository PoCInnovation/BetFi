import { bytesToHex, randomBytes } from '@noble/hashes/utils';
import { generateKeypair } from '../key/key-box.js';
export const createAuthUrl = params => {
  const {
    redirectUrl,
    connectUrl,
    expiryMilliseconds = 240000,
    // 4 minutes
    appId
  } = params;
  const {
    publicKey,
    secretKey
  } = generateKeypair();
  const expiry = Date.now() + expiryMilliseconds;
  const payload = {
    expiry,
    encryptionPublicKey: bytesToHex(publicKey),
    appId
  };
  const data = encodeURIComponent(JSON.stringify(payload));
  const nonce = bytesToHex(randomBytes(32));
  const url = new URL(connectUrl);
  url.searchParams.set('data', data);
  url.searchParams.set('redirect', encodeURIComponent(redirectUrl));
  url.searchParams.set('nonce', nonce);
  return {
    url,
    nonce,
    secretKey: bytesToHex(secretKey),
    publicKey: bytesToHex(publicKey),
    expiry
  };
};
//# sourceMappingURL=create-auth-url.js.map