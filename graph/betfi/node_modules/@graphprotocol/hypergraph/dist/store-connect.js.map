{"version":3,"file":"store-connect.js","names":["createStore","mergeMessages","idToAutomergeId","initialStoreContext","spaces","updatesInFlight","invitations","repo","identities","authenticated","accountAddress","sessionToken","keys","lastUpdateClock","accountInboxes","store","context","on","setInvitations","event","reset","addUpdateInFlight","updateId","removeUpdateInFlight","filter","id","applyEvent","map","space","spaceId","events","state","updateConfirmed","clock","applyUpdate","firstUpdateClock","addVerifiedIdentity","encryptionPublicKey","signaturePublicKey","accountProof","keyProof","setSpaceInbox","existingInbox","inboxes","find","inbox","inboxId","messages","seenMessageIds","setSpaceInboxMessages","lastMessageClock","Date","Math","max","getTime","toISOString","setAccountInbox","setAccountInboxMessages","setSpace","existingSpace","s","result","findWithProgress","handle","doneLoading","newSpace","spaceState","automergeDocHandle","updates","mergedInboxes","newInbox","existingInboxIndex","findIndex","push","setAuth","resetAuth","setRepo"],"sources":["../src/store-connect.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}